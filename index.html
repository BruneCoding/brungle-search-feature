function getSearchResults(query) {
    full.style.display = "block";
    var apiEndpoint = "https://www.googleapis.com/customsearch/v1";
    var cx = "564f027734c9441fe";
    var apiKey = "AIzaSyDIZJhGxmt_TZwEHATT25DmRk29VV_2xgU";

    var url = apiEndpoint + "?key=" + apiKey + "&cx=" + cx + "&q=" + encodeURIComponent(query);

    fetch(url)
        .then(response => response.json())
        .then(data => {
            var searchResultsDiv = document.getElementById("searchResults");
            searchResultsDiv.innerHTML = "";

            if (data.items) {
                data.items.forEach(item => {
                    var resultElement = document.createElement("div");
                    resultElement.classList.add("searchResult");

                    var titleElement = document.createElement("h2");
                    titleElement.innerText = item.title;

                    var snippetElement = document.createElement("p");
                    snippetElement.innerText = item.snippet;

                    var dateElement = document.createElement("div");
                    dateElement.classList.add("date");
                    var formattedDate = item.pagemap?.metatags?.[0]?.["og:updated_time"] ? 
                        new Date(item.pagemap.metatags[0]["og:updated_time"]).toLocaleDateString() : "Unknown date";
                    dateElement.innerText = "Published on: " + formattedDate;

                    var imageElement = document.createElement("img");
                    if (item.pagemap?.cse_image?.[0]?.src) {
                        imageElement.src = item.pagemap.cse_image[0].src;
                    } else {
                        imageElement.style.display = "none";
                    }

                    var linkElement = document.createElement("a");
                    linkElement.href = item.link;
                    linkElement.innerText = "Result from " + new URL(item.link).hostname;
                    linkElement.style.textDecoration = "underline";
                    linkElement.style.color = "#6a6a6a";
                    linkElement.style.display = "block"; // Ensure the link is displayed as a block element
                    linkElement.target = "_blank"; // Open in a new tab

                    resultElement.appendChild(titleElement);
                    resultElement.appendChild(dateElement);
                    resultElement.appendChild(imageElement);
                    resultElement.appendChild(snippetElement);
                    resultElement.appendChild(linkElement);

                    searchResultsDiv.appendChild(resultElement);
                });
            } else {
                searchResultsDiv.innerHTML = "No search results found.";
            }
        })
        .catch(error => {
            console.error("Error fetching search results:", error);
        });
}

function summarizeText(text) {
    return text.substring(0, 100) + "...";
}

function summarizeAndSearch() {
    var inputText = document.getElementById("inputText").value;
    var summaryDiv = document.getElementById("summary");
    var searchResultsDiv = document.getElementById("searchResults");

    summaryDiv.innerHTML = "";
    searchResultsDiv.innerHTML = "";

    var summary = summarizeText(inputText);
    summaryDiv.innerText = "Searching Results for " + summary + " on Brungle!";

    getSearchResults(inputText);
}

// Event listener for Enter key
document.getElementById("inputText").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
        summarizeAndSearch();
    }
});
